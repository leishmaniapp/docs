
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../diseases/">
      
      
        <link rel="next" href="../schema/">
      
      
      <link rel="icon" href="../assets/index/leishmaniapp_neumorphic_light.webp">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.34">
    
    
      
        <title>🔬 Modelos de Detección - Documentación de Leishmaniapp</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.35f28582.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/fonts.css">
    
      <link rel="stylesheet" href="../stylesheets/color.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#modelos-de-deteccion" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Documentación de Leishmaniapp" class="md-header__button md-logo" aria-label="Documentación de Leishmaniapp" data-md-component="logo">
      
  <img src="../assets/index/leishmaniapp_neumorphic_light.webp" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Documentación de Leishmaniapp
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              🔬 Modelos de Detección
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Documentación de Leishmaniapp" class="md-nav__button md-logo" aria-label="Documentación de Leishmaniapp" data-md-component="logo">
      
  <img src="../assets/index/leishmaniapp_neumorphic_light.webp" alt="logo">

    </a>
    Documentación de Leishmaniapp
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🏠 Inicio
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../diseases/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🦠 Enfermedades
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    🔬 Modelos de Detección
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    🔬 Modelos de Detección
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#elementos-diagnosticos" class="md-nav__link">
    <span class="md-ellipsis">
      Elementos Diagnósticos
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Elementos Diagnósticos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formato-de-los-resultados" class="md-nav__link">
    <span class="md-ellipsis">
      Formato de los Resultados
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alef-adapter-layer-exec-format" class="md-nav__link">
    <span class="md-ellipsis">
      ALEF (Adapter Layer Exec Format)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ALEF (Adapter Layer Exec Format)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#entradas" class="md-nav__link">
    <span class="md-ellipsis">
      Entradas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salidas" class="md-nav__link">
    <span class="md-ellipsis">
      Salidas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo" class="md-nav__link">
    <span class="md-ellipsis">
      Ejemplo
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modelos-de-diagnostico-soportados" class="md-nav__link">
    <span class="md-ellipsis">
      Modelos de Diagnóstico Soportados
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modelos de Diagnóstico Soportados">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#leishmaniasis-con-tincion-giemsa" class="md-nav__link">
    <span class="md-ellipsis">
      Leishmaniasis con tinción Giemsa
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Leishmaniasis con tinción Giemsa">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#identificacion-de-parasitos" class="md-nav__link">
    <span class="md-ellipsis">
      Identificación de Parásitos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#identificacion-de-macrofagos" class="md-nav__link">
    <span class="md-ellipsis">
      Identificación de Macrófagos
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#malaria-con-tincion-romanowsky" class="md-nav__link">
    <span class="md-ellipsis">
      Malaria con tinción Romanowsky
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Malaria con tinción Romanowsky">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#funcionamiento" class="md-nav__link">
    <span class="md-ellipsis">
      Funcionamiento
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analisis-externo" class="md-nav__link">
    <span class="md-ellipsis">
      Análisis Externo
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modelos-de-prueba" class="md-nav__link">
    <span class="md-ellipsis">
      Modelos de Prueba
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modelos de Prueba">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#detector-de-colores" class="md-nav__link">
    <span class="md-ellipsis">
      Detector de Colores
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../schema/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    📐 Protobuf Schema
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🌎 Cloud
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🚀 LAM
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../debugger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🪲 Depuradores
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#elementos-diagnosticos" class="md-nav__link">
    <span class="md-ellipsis">
      Elementos Diagnósticos
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Elementos Diagnósticos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formato-de-los-resultados" class="md-nav__link">
    <span class="md-ellipsis">
      Formato de los Resultados
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alef-adapter-layer-exec-format" class="md-nav__link">
    <span class="md-ellipsis">
      ALEF (Adapter Layer Exec Format)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ALEF (Adapter Layer Exec Format)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#entradas" class="md-nav__link">
    <span class="md-ellipsis">
      Entradas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salidas" class="md-nav__link">
    <span class="md-ellipsis">
      Salidas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo" class="md-nav__link">
    <span class="md-ellipsis">
      Ejemplo
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modelos-de-diagnostico-soportados" class="md-nav__link">
    <span class="md-ellipsis">
      Modelos de Diagnóstico Soportados
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modelos de Diagnóstico Soportados">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#leishmaniasis-con-tincion-giemsa" class="md-nav__link">
    <span class="md-ellipsis">
      Leishmaniasis con tinción Giemsa
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Leishmaniasis con tinción Giemsa">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#identificacion-de-parasitos" class="md-nav__link">
    <span class="md-ellipsis">
      Identificación de Parásitos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#identificacion-de-macrofagos" class="md-nav__link">
    <span class="md-ellipsis">
      Identificación de Macrófagos
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#malaria-con-tincion-romanowsky" class="md-nav__link">
    <span class="md-ellipsis">
      Malaria con tinción Romanowsky
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Malaria con tinción Romanowsky">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#funcionamiento" class="md-nav__link">
    <span class="md-ellipsis">
      Funcionamiento
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analisis-externo" class="md-nav__link">
    <span class="md-ellipsis">
      Análisis Externo
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modelos-de-prueba" class="md-nav__link">
    <span class="md-ellipsis">
      Modelos de Prueba
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modelos de Prueba">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#detector-de-colores" class="md-nav__link">
    <span class="md-ellipsis">
      Detector de Colores
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="modelos-de-deteccion">🔬 Modelos de Detección</h1>
<p>Un modelo de detección es un programa capaz de detectar una serie de <em>elementos diagnósticos</em> específicos a una <em>enfermedad</em> dada una imagen de entrada.</p>
<h2 id="elementos-diagnosticos">Elementos Diagnósticos</h2>
<p>El modelo de detección debe de computar una lista de todos los elementos diagnósticos y los componentes de la caja más pequeña que lo contiene (<em>bounding box</em>), estos componentes son:</p>
<ul>
<li><strong>x</strong>: Coordenada horizontal (imagen de la muestra como marco de referencia) de la esquina superior de la caja, unidad en pixeles, dirección, oeste-este</li>
<li><strong>y</strong>: Coordenada vertical (imagen de la muestra como marco de referencia) de la esquina superior de la caja, unidad en pixeles, dirección norte-sur</li>
<li><strong>w</strong>: Ancho de la caja</li>
<li><strong>h</strong>: Alto de la caja</li>
</ul>
<p>Una imagen explicativa de las componentes en referencia a la muestra se muestra a continuación:</p>
<p><a class="glightbox" href="../assets/models/coordinates.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Elementos diagnósticos" src="../assets/models/coordinates.png" /></a></p>
<p>Algunos modelos no pueden computar una <em>bounding box</em> para los elementos y en su lugar utilizan <em>centros de masa</em>, en este caso las componentes <strong>w</strong> y <strong>h</strong> deben contener el valor '0', esto será interpretado por la aplicación de Leishmaniapp como un <em>centro de masa</em> en lugar de una <em>bounding box</em></p>
<h3 id="formato-de-los-resultados">Formato de los Resultados</h3>
<p>Los modelos de detección deben de representar los resultados a través de un mapa llave-valor en la que la llave es el nombre del <em>elemento diagnóstico</em> y el valor es una lista de componentes (<em>coordinates</em>) de cada uno de los elementos encontrados.</p>
<p>Ejemplo: suponga que una enfermedad <em>mock</em> tiene 3 elementos diagnósticos: 'foo', 'bar' y 'baz', a continuación un ejemplo de los posibles resultados del modelo <em>mock</em></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="nt">&quot;foo&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="nt">&quot;bar&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;x&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;w&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;h&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;x&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;w&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;h&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="p">],</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="nt">&quot;baz&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;x&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;w&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;h&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="p">}</span>
</span></code></pre></div>
<p>Esto implica que:</p>
<ul>
<li>No hay ningún elemento del tipo <em>foo</em> en la muestra</li>
<li>Hay 2 elementos del tipo <em>bar</em> en la muestra, uno en las coordenadas (10, 10) y otro en (40, 20), cada uno con su respectiva caja contenedora</li>
<li>Hay 1 elemento del tipo <em>baz</em> en la muestra, su centro de masa se encuentra en la coordenada (25, 20)</li>
</ul>
<h2 id="alef-adapter-layer-exec-format">ALEF (Adapter Layer Exec Format)</h2>
<p>Para que los modelos de análisis puedan ser integrados a <em>LeishmaniappCloudServiceV2</em> (Veáse <a href="../cloud/">documentación de cloud</a>) es necesario implementar un estándar de entradas y salidas que permitan al <em><a href="../cloud/#model_wrapper">model_wrapper</a></em> llamar a los modelos de análisis, este estándar tiene el nombre de <em>ALEF</em> dentro de la infrastructura de Leishmaniapp, el nombre viene dado por el mecanismo que utiliza <em>model_wrapper</em> para hacer el llamado a los modelos (<em>syscall exec</em>).</p>
<h4 id="entradas">Entradas</h4>
<div class="language-properties highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="na">absolute/path/to/executable</span><span class="w"> </span><span class="s">&lt;args&gt; --alef-in &lt;input&gt; --alef-out &lt;output&gt;</span>
</span></code></pre></div>
<ul>
<li>
<p><strong>--alef-in</strong>: Argumento que especifica la ruta relativa o absoluta hacia el archivo de imagen que va a ser utilizado como entrada para el modelo, este argumento es obligatorio.</p>
</li>
<li>
<p><strong>--alef-out</strong>: Argumento que especifica la ruta relativa o absoluta hacia el archivo de imagen que será creado y escrito por el modelo, este archivo puede ser otra imagen que pueda ser requerida como input en otros modelos y es un argumento opcional. Todos los modelos deben de permitir este parámetro pero no necesariamente deben de hacer uso de él, puede ser ignorado.</p>
</li>
</ul>
<p>Se recomienda que cualquier otro parámetro adicional sea opcional, de no ser así por favor asegúrese que los parámetros están correctamente establecidos en el archivo de configuración de <em>model_wrapper</em></p>
<h4 id="salidas">Salidas</h4>
<p>Los resultados del modelo deben de ser escritos a la <em>salida estándar</em> (<code>stdout</code>) y el código terminación del programa debe de ser <code>0</code>, si desea mostrar información de depuración o cualquier otro mensaje relevante para el usuario, debe de hacerlo a través del <em>error estándar</em> (<code>stderr</code>) pues este será ignorado por <em>model_wrapper</em> cuando la petición es exitosa.</p>
<p>Los resultados escritos en la salida estándar deben de estar en formato <em>JSON</em> y seguir un esquema como el del siguiente ejemplo:
<div class="language-json highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="p">{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">  </span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;x&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;w&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;h&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;x&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">65</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">150</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;w&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;h&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;x&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;w&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;h&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">  </span><span class="nt">&quot;b&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;x&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;w&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;h&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;x&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">68</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">185</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;w&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;h&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="p">}</span>
</span></code></pre></div></p>
<p>Estos resultados son traducidos por <code>model_wrapper</code> en los resultados de la estructura <a href="../schema/#muestras">(leishmaniapp.cloud.model.Sample.results)</a>, ejemplo de los resultados traducidos en formato JSON:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="p">{</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="nt">&quot;coordinates&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;x&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;w&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;h&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;x&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">65</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">150</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;w&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;h&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;x&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;w&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;h&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">  </span><span class="nt">&quot;.b&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">    </span><span class="nt">&quot;coordinates&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;x&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;w&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;h&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;x&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">68</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">185</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;w&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;h&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="p">}</span>
</span></code></pre></div>
<p>Si el modelo falla, debe de retornar con un código de terminación diferente de 0, de esta manera <em>model_wrapper</em> puede determinar la falla y se utilizará el texto del <em>error estándar</em> como mensaje de error</p>
<h4 id="ejemplo">Ejemplo</h4>
<p>A continuación un ejemplo del modelo para la enfermedad de pruebas <em>mock.spots</em> utilizando <em>ALEF</em>, utilice este código como base para la implementación de <em>ALEF</em> en sus propios modelos escritos en <em>Python</em></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="ch">#!/usr/bin/python</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="kn">import</span> <span class="nn">argparse</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="kn">import</span> <span class="nn">json</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="kn">import</span> <span class="nn">logging</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">stderr</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="kn">from</span> <span class="nn">model</span> <span class="kn">import</span> <span class="n">DEFAULT_TOLERANCE</span><span class="p">,</span> <span class="n">analyze</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>    <span class="c1"># Create the logger</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>    <span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="n">stderr</span><span class="p">)</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>    <span class="c1"># Set the formatter</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>    <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> [</span><span class="si">%(levelname)s</span><span class="s2">]: </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>    <span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>    <span class="c1"># Set the handler</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>    <span class="c1"># Declare the arguments</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>        <span class="s1">&#39;--alef-in&#39;</span><span class="p">,</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>        <span class="s1">&#39;-i&#39;</span><span class="p">,</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">,</span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;ALEF input filename&quot;</span><span class="p">,</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a>    <span class="p">)</span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a>
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a>        <span class="s1">&#39;--alef-out&#39;</span><span class="p">,</span>
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a>        <span class="s1">&#39;-o&#39;</span><span class="p">,</span>
</span><span id="__span-4-39"><a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">,</span>
</span><span id="__span-4-40"><a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="__span-4-41"><a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;ALEF output (generated mask)&quot;</span><span class="p">,</span>
</span><span id="__span-4-42"><a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a>        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-4-43"><a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a>    <span class="p">)</span>
</span><span id="__span-4-44"><a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a>
</span><span id="__span-4-45"><a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="__span-4-46"><a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a>        <span class="s1">&#39;--tolerance&#39;</span><span class="p">,</span>
</span><span id="__span-4-47"><a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a>        <span class="s1">&#39;-t&#39;</span><span class="p">,</span>
</span><span id="__span-4-48"><a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a>        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;tolerance&quot;</span><span class="p">,</span>
</span><span id="__span-4-49"><a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span><span id="__span-4-50"><a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Range of accepted hue values for a color&quot;</span><span class="p">,</span>
</span><span id="__span-4-51"><a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a>        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-4-52"><a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a>        <span class="n">default</span><span class="o">=</span><span class="n">DEFAULT_TOLERANCE</span><span class="p">,</span>
</span><span id="__span-4-53"><a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a>    <span class="p">)</span>
</span><span id="__span-4-54"><a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a>
</span><span id="__span-4-55"><a id="__codelineno-4-55" name="__codelineno-4-55" href="#__codelineno-4-55"></a>    <span class="c1"># Parse the arguments</span>
</span><span id="__span-4-56"><a id="__codelineno-4-56" name="__codelineno-4-56" href="#__codelineno-4-56"></a>    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span id="__span-4-57"><a id="__codelineno-4-57" name="__codelineno-4-57" href="#__codelineno-4-57"></a>
</span><span id="__span-4-58"><a id="__codelineno-4-58" name="__codelineno-4-58" href="#__codelineno-4-58"></a>    <span class="c1"># Get the tolerance</span>
</span><span id="__span-4-59"><a id="__codelineno-4-59" name="__codelineno-4-59" href="#__codelineno-4-59"></a>    <span class="n">filepath</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">input</span>
</span><span id="__span-4-60"><a id="__codelineno-4-60" name="__codelineno-4-60" href="#__codelineno-4-60"></a>    <span class="n">output</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">output</span>
</span><span id="__span-4-61"><a id="__codelineno-4-61" name="__codelineno-4-61" href="#__codelineno-4-61"></a>    <span class="n">tolerance</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">tolerance</span>
</span><span id="__span-4-62"><a id="__codelineno-4-62" name="__codelineno-4-62" href="#__codelineno-4-62"></a>
</span><span id="__span-4-63"><a id="__codelineno-4-63" name="__codelineno-4-63" href="#__codelineno-4-63"></a>    <span class="c1"># Run the model</span>
</span><span id="__span-4-64"><a id="__codelineno-4-64" name="__codelineno-4-64" href="#__codelineno-4-64"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">analyze</span><span class="p">(</span>
</span><span id="__span-4-65"><a id="__codelineno-4-65" name="__codelineno-4-65" href="#__codelineno-4-65"></a>        <span class="n">filepath</span><span class="p">,</span>
</span><span id="__span-4-66"><a id="__codelineno-4-66" name="__codelineno-4-66" href="#__codelineno-4-66"></a>        <span class="n">output</span><span class="p">,</span>
</span><span id="__span-4-67"><a id="__codelineno-4-67" name="__codelineno-4-67" href="#__codelineno-4-67"></a>        <span class="n">tolerance</span>
</span><span id="__span-4-68"><a id="__codelineno-4-68" name="__codelineno-4-68" href="#__codelineno-4-68"></a>    <span class="p">)</span>
</span><span id="__span-4-69"><a id="__codelineno-4-69" name="__codelineno-4-69" href="#__codelineno-4-69"></a>
</span><span id="__span-4-70"><a id="__codelineno-4-70" name="__codelineno-4-70" href="#__codelineno-4-70"></a>    <span class="c1"># Show the output</span>
</span><span id="__span-4-71"><a id="__codelineno-4-71" name="__codelineno-4-71" href="#__codelineno-4-71"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</span><span id="__span-4-72"><a id="__codelineno-4-72" name="__codelineno-4-72" href="#__codelineno-4-72"></a>
</span><span id="__span-4-73"><a id="__codelineno-4-73" name="__codelineno-4-73" href="#__codelineno-4-73"></a>
</span><span id="__span-4-74"><a id="__codelineno-4-74" name="__codelineno-4-74" href="#__codelineno-4-74"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span><span id="__span-4-75"><a id="__codelineno-4-75" name="__codelineno-4-75" href="#__codelineno-4-75"></a>    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
<h2 id="modelos-de-diagnostico-soportados">Modelos de Diagnóstico Soportados</h2>
<p>A continuación una documentación de cada uno de los modelos de diagnóstico presentes en el respositorio de la organización de Leishmaniapp</p>
<h3 id="leishmaniasis-con-tincion-giemsa">Leishmaniasis con tinción Giemsa</h3>
<p>El identificador para esta enfermedad es <code>leishmaniasis.giemsa</code>, y se compone de dos elementos diagnósticos independientes: El modelo de detección de parásitos (<em>Leishmania spp.</em>) identificado como <code>leishmaniasis.giemsa.parasites</code>, y el modelo de detección de macrófagos identificado como <code>leishmaniasis.giemsa.macrophages</code>.</p>
<table>
<thead>
<tr>
<th>Modelo</th>
<th>Propósito</th>
<th>Repositorio</th>
<th>Elementos Diagnósticos</th>
</tr>
</thead>
<tbody>
<tr>
<td>leishmaniasis.giemsa.parasites</td>
<td>Identificación del parásito <em>Leishmaniap spp.</em> en muestras de Leishmaniasis con tinción giemsa</td>
<td><a href="https://github.com/leishmaniapp/leishmaniasis-giemsa-parasites-model">github.com/leishmaniapp/leishmaniasis-giemsa-parasites-model</a></td>
<td><code>parasite</code></td>
</tr>
<tr>
<td>leishmaniasis.giemsa.macrophages</td>
<td>Identificación de macrófagos en muestras de Leishmaniasis con tinción giemsa</td>
<td><a href="https://github.com/leishmaniapp/leishmaniasis-giemsa-macrophages-model">github.com/leishmaniapp/leishmaniasis-giemsa-macrophages-model</a></td>
<td><code>macrophage</code></td>
</tr>
<tr>
<td>leishmaniasis.giemsa</td>
<td>Modelo conjunto (parásitos y macrófagos) con soporte para <em><a href="../cloud/#model_wrapper">model_wrapper</a></em></td>
<td><a href="https://github.com/leishmaniapp/leishmaniasis-giemsa-disease">github.com/leishmaniapp/leishmaniasis-giemsa-disease</a></td>
<td><code>parasite</code>, <code>macrophage</code></td>
</tr>
<tr>
<td>com.leishmaniapp.lam.leishmaniasis.giemsa</td>
<td>Implementación <em><a href="../lam/">LAM</a></em> para Android de <em>leishmaniasis.giemsa</em> (parásitos y macrófagos)</td>
<td><a href="https://github.com/leishmaniapp/leishmaniasis-giemsa-lam-android">github.com/leishmaniapp/leishmaniasis-giemsa-lam-android</a></td>
<td><code>parasite</code>, <code>macrophage</code></td>
</tr>
</tbody>
</table>
<h4 id="identificacion-de-parasitos">Identificación de Parásitos</h4>
<p>Este modelo hace uso de un clasificador entrenado (archivo <em>pickle</em>) para realizar la detección de parásitos</p>
<p>A continuación un ejemplo de una muestra que no ha sido analizada y los parásitos identificados luego de ser procesada por el modelo (las <em>bounding box</em> han sido exageradas para mejorar la visualización, tomarán un tamaño menor en un análisis real)</p>
<table>
<thead>
<tr>
<th>Muestra sin analizar</th>
<th>Muestra analizada</th>
</tr>
</thead>
<tbody>
<tr>
<td><a class="glightbox" href="../assets/models/leishmaniasis_giemsa/parasites_raw.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Muestra sin analizar de parásitos _leishmaniasis.giemsa_" src="../assets/models/leishmaniasis_giemsa/parasites_raw.png" /></a></td>
<td><a class="glightbox" href="../assets/models/leishmaniasis_giemsa/parasites_analyzed.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Muestra analizada de parásitos _leishmaniasis.giemsa_" src="../assets/models/leishmaniasis_giemsa/parasites_analyzed.png" /></a></td>
</tr>
</tbody>
</table>
<h4 id="identificacion-de-macrofagos">Identificación de Macrófagos</h4>
<p>A continuación un ejemplo de una muestra que no ha sido analizada en contraste con la máscara generada por el modelo de detección de macrófagos y los resultados obtenidos resaltados.</p>
<table>
<thead>
<tr>
<th>Muestra sin analizar</th>
<th>Máscara generada</th>
<th>Elementos resaltados</th>
</tr>
</thead>
<tbody>
<tr>
<td><a class="glightbox" href="../assets/models/leishmaniasis_giemsa/macrophages_raw.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Muestra sin analizar de macrófagos _leishmaniasis.giemsa_" src="../assets/models/leishmaniasis_giemsa/macrophages_raw.png" /></a></td>
<td><a class="glightbox" href="../assets/models/leishmaniasis_giemsa/macrophages_mask.jpg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Máscara generada de macrófagos _leishmaniasis.giemsa_" src="../assets/models/leishmaniasis_giemsa/macrophages_mask.jpg" /></a></td>
<td><a class="glightbox" href="../assets/models/leishmaniasis_giemsa/macrophages_contours.jpg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Contornos resaltados de macrófagos _leishmaniasis.giemsa_" src="../assets/models/leishmaniasis_giemsa/macrophages_contours.jpg" /></a></td>
</tr>
</tbody>
</table>
<p>Este modelo no contiene a los macrófagos en una <em>bounding box</em>, en su lugar, retorna su centro de masa</p>
<h3 id="malaria-con-tincion-romanowsky">Malaria con tinción Romanowsky</h3>
<p>El identificador de esta enfermedad es <code>malaria.romanowsky</code> y es capaz de identificar leucocitos (<code>leukocyte</code>) y parásitos en 3 estadíos (<code>trophozoite</code>, <code>schizont</code> y <code>gametocyte</code>)</p>
<table>
<thead>
<tr>
<th>Modelo</th>
<th>Propósito</th>
<th>Repositorio</th>
<th>Elementos Diagnósticos</th>
</tr>
</thead>
<tbody>
<tr>
<td>malaria.romanowksy</td>
<td>Identificación de leucocitos y parásitos (<em>Plasmodium spp.</em>) en sus estadíos para muestras de Malaria con tinción de Romanowsky</td>
<td><a href="https://github.com/leishmaniapp/malaria-romanowsky-model">github.com/leishmaniapp/malaria-romanowsky-model</a></td>
<td><code>leukocyte</code>,<code>trophozoite</code>, <code>schizont</code>, <code>gametocyte</code></td>
</tr>
<tr>
<td>com.leishmaniapp.lam.malaria.romanowsky</td>
<td>Implementación <em><a href="../lam/">LAM</a></em> para Android de <em>malaria.romanowsky</em></td>
<td><a href="https://github.com/leishmaniapp/malaria-romanowsky-lam-android">github.com/leishmaniapp/malaria-romanowsky-lam-android</a></td>
<td><code>leukocyte</code>,<code>trophozoite</code>, <code>schizont</code>, <code>gametocyte</code></td>
</tr>
</tbody>
</table>
<p>A continuación un ejemplo de una muestra de malaria sin analizar y los resultados de una muestra analizada</p>
<table>
<thead>
<tr>
<th>Muestra sin analizar</th>
<th>Resultados resaltados</th>
</tr>
</thead>
<tbody>
<tr>
<td><a class="glightbox" href="../assets/models/malaria_romanowsky/raw.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Muestra sin analizar _malaria.romanowsky_" src="../assets/models/malaria_romanowsky/raw.png" /></a></td>
<td><a class="glightbox" href="../assets/models/malaria_romanowsky/results.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Resultados de análisis _malaria.romanowsky_" src="../assets/models/malaria_romanowsky/results.png" /></a></td>
</tr>
</tbody>
</table>
<p>Los resultados mostrados anteriormente pueden ser generados con el parámetro <code>--alef-out</code></p>
<h4 id="funcionamiento">Funcionamiento</h4>
<p>El modelo divide la identificación en 6 etapas:</p>
<ol>
<li>Generación de máscara de leucocitos</li>
<li>Identificación de leucocitos</li>
<li>Generación de máscara de parásitos a partir de la máscara de leucocitos</li>
<li>Generación de recortes individuales de parásitos</li>
<li>Clasificación de parásitos</li>
<li>Clasificación de estadío de los parásitos</li>
</ol>
<p>Las etapas del 1 al 4 se realizan exclusivamente mediante el uso de la librería <em>opencv</em>, la etapa de clasificación (5 y 6) utilizan clasificadores entrenados de <em><a href="https://www.tensorflow.org/">TensorFlow Lite</a></em> los cuales pueden ser encontrados en el directorio <code>src/models</code>, estos clasificadores se utilizan sobre cada uno de los recortes de parásitos individuales obtenidos en el paso anterior para determinar si son, o no, un parásito y el estadío en el que se encuentran</p>
<h4 id="analisis-externo">Análisis Externo</h4>
<p>Las etapas de clasificación (5 y 6) hacen uso de la librería <em>TensorFlow Lite</em>, sin embargo, algunas plataformas pueden beneficiarse de librerías nativas que puedan hacer uso de algunos recursos de hardware (como gpu's) a los que <em>Python</em> no tiene acceso. (Caso concreto, modelo <em>LAM</em> hace uso de la librería nativa de <em>TFLite</em>).</p>
<p>Por esto, las etapas de clasificación (5 y 6) pueden ser interrumpidas, y en su lugar; obtener los recortes individuales de parásitos que son el punto de partida para un análisis externo al modelo implementado en <em>Python</em>.</p>
<p>Para activar esta característica utilice el parámetro <code>--external-parasite-analysis=[dir]</code> o <code>-e [dir]</code>, donde <code>[dir]</code> es la ruta absoluta o relativa a un directorio en donde los recortes individuales de los parásitos serán almacenados, el output del modelo será modificado y ahora en lugar de obtener únicamente los <em>elementos diagnósticos</em> y sus componentes, se mostrará una tupla (2-d) con los siguientes valores</p>
<ol>
<li>Mapa llave-valor de resultados <em>ALEF</em></li>
<li>Mapa llave-valor en el que la llave es el nombre del archivo correspondiente a ese recorte de parásito, y como valor sus componentes</li>
</ol>
<blockquote>
<p>⚠️ Esta funcionalidad rompe con el esquema <em>ALEF</em>, por lo que esta opción no es compatible con <em>model_wrapper</em></p>
</blockquote>
<h2 id="modelos-de-prueba">Modelos de Prueba</h2>
<p>Las anteriores enfermedades pueden dificultar el proceso de depuración de la arquitectura, es por eso que existen otra clase de "enfermedades" que son utilizadas únicamente con fines de prueba, los modelos de detección correspondientes a estar enfermedades procesan imagenes de objetos cotidianos que permitan depurar facilmente problemas en la aplicación o arquitectura sin contar con una muestra de laboratorio.</p>
<h3 id="detector-de-colores">Detector de Colores</h3>
<p>El identificador para esta enfermedad/modelo de prueba es <code>mock.spots</code>, detecta los principales canales de color en una imagen y calcula los centros de masa del parche de color más grande en la muestra.</p>
<table>
<thead>
<tr>
<th>Modelo</th>
<th>Propósito</th>
<th>Repositorio</th>
<th>Elementos Diagnósticos</th>
</tr>
</thead>
<tbody>
<tr>
<td>mock.spots</td>
<td>Identificación de parches de color</td>
<td><a href="https://github.com/leishmaniapp/mock-spots-model">github.com/leishmaniapp/mock-spots-model</a></td>
<td><code>red</code>, <code>green</code>, <code>blue</code>, <code>yellow</code>, <code>cyan</code>, <code>magenta</code></td>
</tr>
<tr>
<td>com.leishmaniapp.lam.mock.spots</td>
<td>Implementación <em><a href="../lam/">LAM</a></em> para Android de <em>mock.spots</em></td>
<td><a href="https://github.com/leishmaniapp/mock-spots-lam-android">github.com/leishmaniapp/mock-spots-lam-android</a></td>
<td><code>red</code>, <code>green</code>, <code>blue</code>, <code>yellow</code>, <code>cyan</code>, <code>magenta</code></td>
</tr>
</tbody>
</table>
<p>A continuación un ejemplo de una muestra de un cubo de rubik con los colores rojo, amarillo y verde; en contraste con la máscara generada por el modelo y un pequeño punto blanco marcando el <em>centro de masa</em> de cada parche de color</p>
<table>
<thead>
<tr>
<th>Muestra sin analizar</th>
<th>Máscara generada</th>
</tr>
</thead>
<tbody>
<tr>
<td><a class="glightbox" href="../assets/models/mock_spots/raw.jpg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="_mock.spots_ sin analizar" src="../assets/models/mock_spots/raw.jpg" /></a></td>
<td><a class="glightbox" href="../assets/models/mock_spots/mask.jpg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="_mock.spots_ máscara" src="../assets/models/mock_spots/mask.jpg" /></a></td>
</tr>
</tbody>
</table>
<p>Los resultados de este modelo no se encuentran enmarcados por un <em>bounding box</em>, en su lugar, se calcula el centro de masa de cada uno de los parches de color.</p>
<p>Para ajustar la sensibilidad del modelo utilice el parámetro de entrada <code>--tolerance</code> o <code>-t</code>, el valor por defecto de la tolerancia es 10. Si quiere visualizar la máscara resultante puede hacer uso del parámetro <code>--alef-out</code> o <code>-o</code></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.56dfad97.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>